@page "/"
@using SeaHome.Services
@inject IJSRuntime JSRuntime
@inject SingletonService singleton
@inject ApartamentService apartmentService
@inject GridFSService service

@*<h1>Display Google Map</h1>
<div id="map" style="height:400px;width:100%;">
</div>*@

<form align="center">
@*<div style="position:relative;overflow:hidden;">
    <a href="https://yandex.ru/maps?utm_medium=mapframe&utm_source=maps" 
        style="color:#eee;font-size:12px;position:absolute;top:0px;">
        Яндекс Карты
    </a>
    <a href="https://yandex.ru/maps/?ll=34.082655%2C44.460566&mode=usermaps&source=constructorLink&um=constructor%3A161992161b6ce836895ae5f13a9527cf18bc4d347b3666b5c310daa79b57effc&utm_medium=mapframe&utm_source=maps&z=12" 
        style="color:#eee;font-size:12px;position:absolute;top:14px;">
        Яндекс Карты — транспорт, навигация, поиск мест
    </a>
        <iframe src="https://yandex.ru/map-widget/v1/-/CCUJaRuMKC" width="90%" height="400" class="border border-primary" frameborder="3" allowfullscreen="true" style="position:relative;">
        </iframe>
</div>*@

@*<div style="position:relative;overflow:hidden;">
    <a href="https://yandex.ru/maps?utm_medium=mapframe&utm_source=maps" 
        style="color:#eee;font-size:12px;position:absolute;top:0px;">
        Яндекс Карты
    </a>
    <a href="https://yandex.ru/maps/?ll=34.119708%2C44.454210&mode=usermaps&source=constructorLink&um=constructor%3A161992161b6ce836895ae5f13a9527cf18bc4d347b3666b5c310daa79b57effc&utm_medium=mapframe&utm_source=maps&z=12" 
        style="color:#eee;font-size:12px;position:absolute;top:14px;">
        Яндекс Карты — транспорт, навигация, поиск мест
    </a>
    <iframe src="https://yandex.ru/map-widget/v1/?um=constructor%3A161992161b6ce836895ae5f13a9527cf18bc4d347b3666b5c310daa79b57effc&amp;source=constructor" width="895" height="400" class="border border-primary border-3" frameborder="10" allowfullscreen="true">
        </iframe>
</div>*@


    <div id="map" style="height:400px;width:90%;"></div>



<br /><br />
<table align="center" width="60%">
    @foreach (Apartament item in apartmentService.GetApartaments())
    {
       <tbody class="border border-primary border-1">
            <tr>
                <td class="p-3">
                    <tr>стоимость: @item.Price</tr><br/>
                    <tr><textbox rows="5">@item.Text</textbox></tr>
                    <br/>
                    <tr>этаж: @item.Floor</tr>
                    <tr>этажность здания: @item.HouseFloor</tr>
                    <tr>
                        <a href="currentApartament">
                            <button class="btn btn-link" @onclick='(()=>singleton.SetCurrentApartament(item))'>Открыть</button> 
                        </a>
                    </tr>
                </td>
                <td class="p-3">
                    @if (apartmentService.GetImages(item).Count == 0)
                        {
                            <td>фотографии не добавлены</td>
                        }
                    else
                        {
                            ImgToDb imageDB = apartmentService.GetImage(item);
                            service.DownloadImageToWWWRoot(imageDB.Name);
                            <td><a @onclick="(() => singleton.SetCurrentApartament(item))" href="currentApartament" ><img src="/images/@service.file" width="300px" /></a></td>
                        }
                </td>
                
            </tr>
        </tbody>
     }
</table>
</form>


@code{
    //--for GoogleMaps
    //protected override async Task OnAfterRenderAsync(bool firstRender)
    //{
    //    if (firstRender)
    //    {
    //        await JSRuntime.InvokeVoidAsync("initialize", null); 
    //    }
    //}

    //--for YMap
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeVoidAsync("init", null); 
        }
    }
}